{% extends "layout.html" %}
{% block content %}

<div class="container-fluid mt-4">
    <div class="row">
        <!-- Plutajući bočni meni -->
        <div class="col-md-3">
            <div id="floating-sidebar" class="floating-menu">
                <div class="card">
                    <div class="card-header bg-implicit-deepblue text-white">
                        <h4 class="mb-0">Sadržaj</h4>
                    </div>
                    <div class="card-body">
                        <nav id="news-sidebar" class="nav flex-column">
                            <a class="nav-link sidebar-link" href="#vest-012">Izvoz spiska zaduženja učenika u Excel sa primenjenim filterima</a>
                            <a class="nav-link sidebar-link" href="#vest-011">Rasknjižavanje dugovanja sa praćenjem transakcija</a>
                            <a class="nav-link sidebar-link" href="#vest-010">Filter - Tekuća školska godina</a>
                            <a class="nav-link sidebar-link" href="#vest-009">Preknjižavanje sredstava između različitih usluga na kartici učenika</a>
                            <a class="nav-link sidebar-link" href="#vest-008">Dugovanja učenika - generisanje kartice učenika i uplatnica po saldu</a>
                            <a class="nav-link sidebar-link" href="#vest-007">Generisanje uplatnice za preostali dug po usluzi</a>
                            <a class="nav-link sidebar-link" href="#vest-006">Izvoz spiska učenika u Excel sa primenjenim filterima</a>
                            <a class="nav-link sidebar-link" href="#vest-005">Unošenje podataka primaoca na evidencionim računima</a>
                            <a class="nav-link sidebar-link" href="#vest-004">Slanje kartice stanja učenika roditelju putem imejla</a>
                            <a class="nav-link sidebar-link" href="#vest-003">Prikaz ukupnog broja zaduženih učenika u odeljenju</a>
                            <a class="nav-link sidebar-link" href="#vest-002">Prepoznavanje i zaduživanje novih učenika u odeljenju u arhivi naloga</a>
                            <a class="nav-link sidebar-link" href="#vest-001">Generisanje i štampanje selektovanih uplatnica</a>
                        </nav>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Glavni sadržaj -->
        <div class="col-md-9">
            <!-- dvanaesta vest -->
            <div id="vest-012" class="card mb-5">
                <div class="card-header bg-implicit-deepblue text-white">
                    <h3>Izvoz spiska zaduženja učenika u Excel sa primenjenim filterima</h3>
                </div>
                <div class="card-body">
                    <div class="news-item">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <h4>Detalji unapređenja</h4>
                            <span class="badge bg-secondary">24.09.2025.</span>
                        </div>
                        <p>U bloku PREGLED na stranici <a href="{{ url_for('overviews.overview_debts') }}">Dugovanja učenika</a> postavljena je nova ikonica, u vrhu strane iznad tabele, koja omogućava izvoz spiska učenika u Excel formatu prema primenjenim filterima.</p>
                    </div>
                </div>
            </div>
            <!-- Jedanaesta vest -->
            <div id="vest-011" class="card mb-5">
                <div class="card-header bg-implicit-deepblue text-white">
                    <h3>Rasknjižavanje dugovanja sa praćenjem transakcija</h3>
                </div>
                <div class="card-body">
                    <div class="news-item">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <h4>Detalji unapređenja</h4>
                            <span class="badge bg-secondary">24.09.2025.</span>
                        </div>
                        <p>Uvedena je nova mogućnost rasknjižavanja sredstava sa usluge na kartici učenika. Funkcionalnost je postavljena na strani <a href="{{ url_for('transactions.transfers_list') }}">Preknjižavanje</a>, u bloku KNJIŽENJE. Na kartici učenika svako rasknjižavanje beleži se u tabeli pojedinačne usluge sa koje je izvršeno rasknjižavanje. Pored toga, u bloku ARHIVA, na strani <a href="{{ url_for('transactions.transfers_list') }}">Arhiva preknjižavanja</a> zapisane su sve transakcije vezane za rasknjižavanje sredstava.</p>
                    </div>
                </div>
            </div>
            
            <!-- deseta vest -->
            <div id="vest-010" class="card mb-5">
                <div class="card-header bg-implicit-deepblue text-white">
                    <h3>Filter - Tekuća školska godina</h3>
                </div>
                <div class="card-body">
                    <div class="news-item">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <h4>Detalji unapređenja</h4>
                            <span class="badge bg-secondary">24.09.2025.</span>
                        </div>
                        <p>Na stranama <a href="{{ url_for('overviews.overview_students') }}">Pregled po učeniku</a>, <a href="{{ url_for('overviews.overview_sections') }}">Škola</a> i na kartici pojedinačnog učenika dodat je prekidač (swtich) za aktiviranje filtera - tekuća  školska godina. Aktiviranjem ove opcije, prikazaće se podaci vezani isključivo za tekuću školsku godinu.</p>
                    </div>
                </div>
            </div>
            
            <!-- Deveta vest -->
            <div id="vest-009" class="card mb-5">
                <div class="card-header bg-implicit-deepblue text-white">
                    <h3>Preknjižavanje sredstava između različitih usluga na kartici učenika</h3>
                </div>
                <div class="card-body">
                    <div class="news-item">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <h4>Detalji unapređenja</h4>
                            <span class="badge bg-secondary">22.09.2025.</span>
                        </div>
                        <p>Uvedena je nova mogućnost preknjižavanja sredstava između usluga na kartici učenika. Funkcionalnost je postavljena na strani <a href="{{ url_for('transactions.transfers_list') }}">Preknjižavanje</a>, u bloku KNJIŽENJE. Na kartici učenika svako preknjižavanje beleži se u tabeli pojedinačne usluge sa koje je izvršeno preknjižavanje i u tabeli usluga na koju je izvršeno preknjižavanje sredstava. Pored toga, u bloku ARHIVA, na strani <a href="{{ url_for('transactions.transfers_list') }}">Arhiva preknjižavanja</a> zapisane su sve transakcije vezane za preknjižavanje sredstava.</p>
                    </div>
                </div>
            </div>
            
            <!-- osma vest -->
            <div id="vest-008" class="card mb-5">
                <div class="card-header bg-implicit-deepblue text-white">
                    <h3>Dugovanja učenika - generisanje kartice učenika i uplatnica po saldu</h3>
                </div>
                <div class="card-body">
                    <div class="news-item">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <h4>Detalji unapređenja</h4>
                            <span class="badge bg-secondary">20.09.2025.</span>
                        </div>
                        <p>U okviru bloka PREGLED dostupna je nova stranica <a href="{{ url_for('overviews.overview_debts') }}">Dugovanja učenika</a> koja omogućava generisanje kartice učenika i uplatnica po saldu za neizmirene obaveze.</p>
                        <p>Na stranici su dostupne opcije: pregled detalja učenika, generisanje PDF-a sa karticom stanja i uplatnicama. Filtriranje je moguće izvršiti po minimalnoj visini dugovanja I po jednoj ili više usluga.</p>
                        <p>Za škole kojima je aktivirana opcija slanja imejlom, dostupna je i opcija slanja kartice i uplatnica putem imejla.</p>
                    </div>
                </div>
            </div>
            
            <!-- Sedma vest -->
            <div id="vest-007" class="card mb-5">
                <div class="card-header bg-implicit-deepblue text-white">
                    <h3>Generisanje uplatnice za preostali dug po usluzi</h3>
                </div>
                <div class="card-body">
                    <div class="news-item">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <h4>Detalji unapređenja</h4>
                            <span class="badge bg-secondary">20.09.2025.</span>
                        </div>
                        <p>Na kartici učenika omogućeno je štampanje uplatnice vezane isključivo za saldo, a ne za celokupno dugovanje. U okviru tabele pojedinačne usluge dodat je red koji, ukoliko je saldo veći od nule, prikazuje ikonicu za generisanje uplatnice samo za preostali dug.</p>
                    </div>
                </div>
            </div>
            
            <!-- Šesta vest -->
            <div id="vest-006" class="card mb-5">
                <div class="card-header bg-implicit-deepblue text-white">
                    <h3>Izvoz spiska učenika u Excel sa primenjenim filterima</h3>
                </div>
                <div class="card-body">
                    <div class="news-item">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <h4>Detalji unapređenja</h4>
                            <span class="badge bg-secondary">20.09.2025.</span>
                        </div>
                        <p>U bloku PODACI na stranici <a href="{{ url_for('students.student_list') }}">Učenici</a> postavljena je nova ikonica, u vrhu strane iznad tabele, koja omogućava izvoz spiska učenika u Excel formatu prema primenjenim filterima.</p>
                    </div>
                </div>
            </div>
            
            <!-- Peta vest -->
            <div id="vest-005" class="card mb-5">
                <div class="card-header bg-implicit-deepblue text-white">
                    <h3>Unošenje podataka primaoca na evidencionim računima</h3>
                </div>
                <div class="card-body">
                    <div class="news-item">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <h4>Detalji unapređenja</h4>
                            <span class="badge bg-secondary">20.09.2025.</span>
                        </div>
                        <p>U bloku PODACI, na stranici <a href="{{ url_for('schools.school_profile') }}">Podaci škole</a>, u sekciji Finansijske informacije, dodata su dva nova polja - <strong>Naziv primaoca</strong> i <strong>Adresa primaoca</strong> za svaki evidencioni račun. Ukoliko ih ostavite nepopunjena, na uplatnici se, u polju Primalac, generiše naziv i adresa škole. Ukoliko u predviđenim poljima unesete naziv primaoca (na primer: Donacije, pomoći i transferi u korist RS) i adresu, na uplatnici će biti generisan upisani naziv i adresa primaoca.</p>
                    </div>
                </div>
            </div>
            
            <!-- Četvrta vest -->
            <div id="vest-004" class="card mb-5">
                <div class="card-header bg-implicit-deepblue text-white">
                    <h3>Slanje kartice stanja učenika roditelju putem imejla</h3>
                </div>
                <div class="card-body">
                    <div class="news-item">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <h4>Detalji unapređenja</h4>
                            <span class="badge bg-secondary">20.09.2025.</span>
                        </div>
                        <p>Na strani kartice stanja pojedinačnog učenika dodata je opcija za direktno slanje kartice stanja roditelju na osnovu filtriranih rezultata. Kod učenika koji imaju aktivan imejl, vidljiva je nova ikonica za slanje u gornjem desnom uglu, pored ikonice štampača. Klikom na nju automatski se generiše i šalje PDF.</p>
                    </div>
                </div>
            </div>
            
            <!-- Treća vest -->
            <div id="vest-003" class="card mb-5">
                <div class="card-header bg-implicit-deepblue text-white">
                    <h3>Prikaz ukupnog broja zaduženih učenika u odeljenju</h3>
                </div>
                <div class="card-body">
                    <div class="news-item">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <h4>Detalji unapređenja</h4>
                            <span class="badge bg-secondary">20.09.2025.</span>
                        </div>
                        <p>Prilikom zaduživanja učenika ili pregleda pojedinačnog naloga u arhivi naloga, desno, na dnu, ispod tabele, prikazuje se ukupan broj zaduženih učenika u odeljenju. Ova opcija omogućava da odmah proverite da li su svi potrebni učenici obuhvaćeni bez ručnog prebrojavanja.</p>
                    </div>
                </div>
            </div>
            
            <!-- Druga vest -->
            <div id="vest-002" class="card mb-5">
                <div class="card-header bg-implicit-deepblue text-white">
                    <h3>Prepoznavanje i zaduživanje novih učenika u odeljenju u arhivi naloga</h3>
                </div>
                <div class="card-body">
                    <div class="news-item">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <h4>Detalji unapređenja</h4>
                            <span class="badge bg-secondary">20.09.2025.</span>
                        </div>
                        <p>Ispravilen je problem zbog kog softver povremeno nije prepoznavao novog učenika u odeljenju kod odeljenja prethodno zaduženih određenom uslugom. Sada je prepoznavanje potpuno pouzdano, a opcija „Dodaj novog učenika“ radi bez zastoja, omogućavajući zaduživanje novih učenika.</p>
                    </div>
                </div>
            </div>
            
            <!-- Prva vest -->
            <div id="vest-001" class="card mb-5">
                <div class="card-header bg-implicit-deepblue text-white">
                    <h3>Generisanje i štampanje selektovanih uplatnica</h3>
                </div>
                <div class="card-body">
                    <div class="news-item">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <h4>Detalji unapređenja</h4>
                            <span class="badge bg-secondary">20.09.2025.</span>
                        </div>
                        <p>U arhivi naloga, na stranici pojedinačnog naloga omogućena je opcija generisanja i štampanja više selektovanih uplatnica. Ova opcija omogućava štampanje više od jedne, a manje od svih generisanih uplatnica. Zaduženi učenici nalaze se prvi na listi, što olakšava selekciju uplatnica za štampanje. Nakon selekcije, potrebno je kliknuti na dugme Generišite selektovane uplatnice, koje se nalazi ispod liste učenika.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<button onclick="scrollToTop()" id="backToTopBtn" title="Povratak na vrh">↑</button>

{% endblock %}

{% block scripts %}
<style>
    .floating-menu {
        position: fixed;
        top: 80px;
        width: 22%;
        z-index: 100;
        max-height: calc(100vh - 100px);
        overflow-y: auto;
        padding-right: 5px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        border-radius: 4px;
    }

    .sidebar-link {
        color: #104e97;
        font-weight: 500;
        border-left: 3px solid transparent;
        transition: all 0.3s ease;
        padding: 8px 15px;
        margin-bottom: 5px;
    }
    
    .sidebar-link:hover,
    .sidebar-link.active {
        background-color: rgba(16, 78, 151, 0.1);
        border-left: 3px solid #104e97;
        color: #104e97;
        font-weight: bold;
    }
    
    .news-item {
        margin-bottom: 15px;
    }
    
    .badge {
        font-size: 0.85rem;
        padding: 6px 10px;
    }
    
    #backToTopBtn {
        display: none;
        position: fixed;
        bottom: 20px;
        right: 20px;
        z-index: 99;
        background-color: #104e97;
        color: white;
        border: none;
        padding: 10px 18px;
        border-radius: 10px;
        cursor: pointer;
        font-size: 18px;
    }
    
    #backToTopBtn:hover {
        background-color: #0c3c72;
    }
</style>

<script>
    // Funkcija za scroll to top dugme
    window.onscroll = function() {
        scrollFunction();
        updateActiveNavItem();
        updateSidebarPosition();
    };

    function scrollFunction() {
        var btn = document.getElementById("backToTopBtn");
        if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
            btn.style.display = "block";
        } else {
            btn.style.display = "none";
        }
    }

    function scrollToTop() {
        document.body.scrollTop = 0; // Za Safari
        document.documentElement.scrollTop = 0; // Za Chrome, Firefox, IE i Operu
    }
    
    // Funkcija za ažuriranje aktivnog linka
    function updateActiveNavItem() {
        // Dobijamo sve vesti i sve linkove u meniju
        const newsItems = document.querySelectorAll('div[id^="vest-"]');
        const navLinks = document.querySelectorAll('.sidebar-link');
        
        // Podaci za izračunavanje pozicije
        const scrollPosition = window.scrollY + 150;
        let activeItemFound = false;
        
        // Prolazimo kroz sve vesti od gore ka dole
        for (let i = 0; i < newsItems.length; i++) {
            const currentItem = newsItems[i];
            const nextItem = newsItems[i + 1] || null;
            
            // Prva vidljiva vest je ona koja je trenutno u fokusu
            const itemTop = currentItem.offsetTop;
            const itemBottom = nextItem ? nextItem.offsetTop : document.body.scrollHeight;
            
            // Pronalazimo odgovarajući link za trenutnu vest
            const currentItemId = currentItem.getAttribute('id');
            const correspondingLink = document.querySelector(`.sidebar-link[href="#${currentItemId}"]`);            
            
            // Proveravamo da li je trenutna pozicija unutar granica vesti
            if (scrollPosition >= itemTop && (scrollPosition < itemBottom || !nextItem)) {
                // Uklanjamo aktivnu klasu sa svih linkova
                navLinks.forEach(link => link.classList.remove('active'));
                
                // Ako postoji odgovarajući link, označavamo ga kao aktivan
                if (correspondingLink) {
                    correspondingLink.classList.add('active');
                    activeItemFound = true;
                    break;
                }
            }
        }
        
        // Ako ništa nije aktivno (npr. na vrhu stranice), aktiviramo prvi link
        if (!activeItemFound && navLinks.length > 0 && scrollPosition < newsItems[0].offsetTop) {
            navLinks.forEach(link => link.classList.remove('active'));
            navLinks[0].classList.add('active');
        }
    }
    
    // Funkcija za ažuriranje pozicije i širine sidebar-a
    function updateSidebarPosition() {
        const sidebar = document.getElementById('floating-sidebar');
        const container = document.querySelector('.col-md-3');
        if (sidebar && container) {
            const containerRect = container.getBoundingClientRect();
            sidebar.style.width = containerRect.width + 'px';
            sidebar.style.left = containerRect.left + 'px';
        }
    }

    // Inicijalizacija
    document.addEventListener("DOMContentLoaded", function() {
        // Inicijalno postavljanje aktivnog linka
        updateActiveNavItem();
        // Inicijalno postavljanje pozicije sidebar-a
        updateSidebarPosition();
        
        // Ažuriranje pozicije pri promeni veličine prozora
        window.addEventListener('resize', updateSidebarPosition);
        
        // Glatko skrolovanje za sidrene linkove
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function(e) {
                e.preventDefault();
                
                const targetId = this.getAttribute('href');
                const targetElement = document.querySelector(targetId);
                
                if (targetElement) {
                    // Označavamo kliknuti link kao aktivan pre skrolovanja
                    document.querySelectorAll('.sidebar-link').forEach(link => link.classList.remove('active'));
                    this.classList.add('active');
                    
                    window.scrollTo({
                        top: targetElement.offsetTop - 20,
                        behavior: 'smooth'
                    });
                }
            });
        });
    });
</script>
{% endblock %}