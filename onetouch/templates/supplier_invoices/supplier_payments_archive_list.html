{% extends "layout.html" %}
{% block content %}
<style>
    @media (max-width: 991px)  {
        .mobtable td:nth-of-type(1):before { content: "Datum izvoda"; }
        .mobtable td:nth-of-type(2):before { content: "Podračun"; }
        .mobtable td:nth-of-type(3):before { content: "Broj izvoda"; }
        .mobtable td:nth-of-type(4):before { content: "Iznos duguje"; }
        .mobtable td:nth-of-type(5):before { content: "Broj isplata (Broj grešaka)"; }
        .mobtable td:nth-of-type(6):before { content: "Akcije"; }
    }
</style>
<div class="row mb-3">
    <div class="col">
        <a class="btn btn-primary loading" href="{{url_for('supplier_invoices.posting_supplier_payment')}}">
            <i class="fa fa-upload"></i> Uvezite novi izvod
        </a>
    </div>
</div>

<table id="data" class="table table-striped dataTable no-footer invoices mobtable" role="grid">
    <thead>
        <tr>
            <th>Datum izvoda</th>
            <th>Podračun</th>
            <th>Broj izvoda</th>
            <th>Iznos duguje</th>
            <th>Broj isplata (Broj grešaka)</th>
            <th></th>
        </tr>
    </thead>
    <tbody>
        {% for item in payment_data %}
        <tr>
            <td data-order="{{ item.payment.payment_date.strftime('%Y%m%d') }}">{{ item.payment.payment_date.strftime('%d.%m.%Y.') }}</td>
            <td>{{ item.payment.bank_account }}</td>
            <td>{{ item.payment.statment_nubmer }}</td>
            <td class="text-danger">{{ "{:,.2f}".format(item.total_amount) }}</td>
            <td>{{ item.supplier_count }} ({{ item.payment.number_of_errors }})</td>
            <td>
                <a class="btn-x btn-primary-x loading" href="{{ url_for('supplier_invoices.supplier_payment_archive', payment_id=item.payment.id) }}" title="Pregled izvoda">
                    <i class="fa fa-magnifying-glass awesomeedit"></i>
                </a>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% endblock content%}

{% block scripts %}
<script>
    $(document).ready(function () {
        $('#data').DataTable({
            "stateSave": true,
            "stateDuration": 900, // 15 minuta
            language: {
                url: "//cdn.datatables.net/plug-ins/1.12.1/i18n/sr-SP.json"
            },
            columnDefs: [
                { type: 'date-eu', targets: 0 }
            ],
            order: [[0, 'desc']]
        });

        // Oboji redove sa greškama u crveno
        const rows = document.querySelectorAll('#data tbody tr');

        rows.forEach(row => {
            const tds = row.querySelectorAll('td');
            let containsZero = false;

            tds.forEach(td => {
                if (td.textContent.includes('(0)')) {
                    containsZero = true;
                }
            });

            if (!containsZero) {
                row.style.backgroundColor = 'rgba(255,0,0,0.1)';
            }
        });
    });
</script>
{% endblock %}
